<!DOCTYPE html>
<html>
  <head>
    <title>Detalles de: <%= profesor.nombre %></title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <header>
      <div id="inicio"><a href="/">Inicio</a></div>
    </header>

    <h1><%= profesor.nombre %></h1>

    <div class="info-section">
      <h2>Información del Profesor</h2>
      <p><strong>ID:</strong> <%= profesor.profesor_id %></p>
      <p><strong>Email:</strong> <%= profesor.email || 'No disponible' %></p>
      <p><strong>Tarjeta ID:</strong> <%= profesor.tarjeta_id %></p>

      <% if (profesor.lastLocation) { %>
      <p>
        <strong>Última ubicación registrada:</strong>
        <% if (profesor.lastLocation.isentry) { %>
        <span class="status-entry"
          >Aula "<%= profesor.lastLocation.aula_nombre %>"</span
        >
        <% } else { %>
        <span class="status-exit">Profesor no disponible</span>
        <% } %> desde <%= new
        Date(profesor.lastLocation.timestamp).toLocaleString('es-AR') %>
      </p>
      <% } else { %>
      <p>
        <strong>Última ubicación registrada:</strong> No hay registros de aula.
      </p>
      <% } %>
    </div>

    <div class="info-section">
      <h2>Materias Dictadas</h2>
      <% if (profesor.materias && profesor.materias.length > 0) { %>
      <ul>
        <% profesor.materias.forEach((materia) => { %>
        <li>
          <a href="/materia/<%= materia.materia_id %>"><%= materia.nombre %></a>
          (ID: <%= materia.materia_id %>)
        </li>
        <% }); %>
      </ul>
      <% } else { %>
      <p><%= profesor.nombre %> no tiene materias asignadas en el sistema.</p>
      <% } %>
    </div>

    <% if (profesor.lastLocation && profesor.lastLocation.isentry &&
    profesor.lastLocation.esp32_id) { %>
    <div class="contact-container">
      <h2>Contactar a <%= profesor.nombre %></h2>
      <form
        action="/profesor/<%= profesor.profesor_id %>/preguntar"
        method="POST"
      >
        <input
          type="hidden"
          name="esp32Id"
          value="<%= profesor.lastLocation.esp32_id %>"
        />
        <div class="input-group">
          <label for="alumno">Tu Nombre</label>
          <input
            id="alumno"
            name="alumno"
            maxlength="16"
            placeholder="Ingresa tu nombre"
            required
          ></input>
          <span id="char-count" class="char-count">
            Caracteres restantes: <span id="char-count-value">16</span>
          </span>
        </div>
        <button type="submit">Registrar Consulta</button>
      </form>
    </div>
    <% } else { %>
    <p class="disabled-form">
      El profesor no está disponible para recibir mensajes en este momento.
    </p>
    <% } %>

    <script>
      const textarea = document.getElementById("alumno");
      const charCountValue = document.getElementById("char-count-value");
      if (textarea && charCountValue) {
        const maxLength = textarea.getAttribute("maxlength");
        charCountValue.textContent = maxLength;
        textarea.addEventListener("input", function () {
          const currentLength = this.value.length;
          charCountValue.textContent = maxLength - currentLength;
        });
      }
    </script>
  </body>
</html>
